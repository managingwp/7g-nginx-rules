# Fluent Forms: allow CSV export requests that are incorrectly flagged by 7G bad_querystring rule 36.
# This keeps the exclusion narrowly scoped to the expected admin-ajax action.
set $exclusion_rule_match "";

# Condition A: request is the WordPress admin AJAX endpoint.
if ( $uri = /wp-admin/admin-ajax.php ) {
    set $test A;
}

# Condition B: query string contains the exact Fluent Forms export action parameter.
if ( $args ~* (^|&)action=fluentform-form-entries-export(&|$) ) {
    set $test "${test}B";
}

# Apply exclusion only when both conditions match.
if ( $test = AB ) {
    set $exclusion_rule_match 36;
}

# Disable drop behavior only for the matched bad_querystring rule.
if ( $bad_querystring_7g = $exclusion_rule_match ) {
    set $7g_drop_bad_query_string 0;
}
